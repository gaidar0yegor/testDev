# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices/configuration.html#application-related-configuration
parameters:
    # Default request context, used i.e to create url from commands
    router.request_context.host: '%env(REQUEST_BASE_HOST)%'
    router.request_context.base_url: '%env(REQUEST_BASE_PATH)%'
    asset.request_context.base_path: '%router.request_context.base_url%'

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'
            - '../src/Tests/'

    # controllers are imported separately to make sure services can be injected
    # as action arguments even if you don't extend any base controller class
    App\Controller\:
        resource: '../src/Controller/'
        tags: ['controller.service_arguments']

    App\Command\NotificationCommand\:
        resource: '../src/Command/NotificationCommand/'
        calls:
            - setSocieteRepository: ['@App\Repository\SocieteRepository']

    App\Command\TestSmsCommand:
        $smsDsn: '%env(SMS_DSN)%'

    Twig\Extensions\IntlExtension: ~

    App\Service\RdiMailer:
        $mailFrom: '%env(MAILER_FROM)%'

    App\Service\Timesheet\Export\TimesheetExporter:
        $exportFormats: !tagged_iterator app.timesheet_export.format

    App\Service\Timesheet\Export\Format\:
        resource: '../src/Service/Timesheet/Export/Format/'
        tags: ['app.timesheet_export.format']

    App\Service\Timesheet\Export\Format\SpreadsheetExport:
        tags: ['app.timesheet_export.format']
        arguments:
            $tmpDir: '%kernel.cache_dir%/timesheets-export-tmp'

    App\Controller\RecommanderController:
        $defaultMailFrom: '%env(MAILER_FROM)%'

    App\Activity\Type\:
        resource: '../src/Activity/Type/'
        tags: ['app.activity_handler']

    App\Activity\ActivityService:
        arguments:
            $activityHandlers: !tagged_iterator { tag: 'app.activity_handler', default_index_method: 'getType' }
        tags: ['doctrine.event_subscriber']

    App\Service\EntityLink\EntityLinkGenerator\:
        resource: '../src/Service/EntityLink/EntityLinkGenerator/'
        tags: ['app.entity_link_generator']

    App\Service\EntityLink\EntityLinkService:
        $linkGenerators: !tagged_iterator { tag: 'app.entity_link_generator', default_index_method: 'supportsEntity' }

    Elasticsearch\Client:
        lazy: true
        factory: ['App\Service\RdiScore\ElasticSearchClientFactory', 'createClient']
        arguments:
            - '%env(ELASTIC_SEARCH_HOST)%'

    App\Service\RdiScore\ScoreUpdater:
        $projetIndex: '%env(ELASTIC_SEARCH_INDEX_PROJET)%'

    App\Onboarding\Step\:
        resource: '../src/Onboarding/Step/'
        tags: ['app.onboarding_step']

    App\Onboarding\Onboarding:
        $onboardingSteps: !tagged_iterator { tag: 'app.onboarding_step', default_priority_method: getPriority }

    App\HelpText\HelpText:
        $templatesDir: '%twig.default_path%'

    App\Slack\Slack:
        $slackClientId: '%env(SLACK_APP_CLIENT_ID)%'
        $slackClientSecret: '%env(SLACK_APP_CLIENT_SECRET)%'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones
