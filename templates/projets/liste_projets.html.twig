{% extends 'base.html.twig' %}

{% block title %}Liste des projets{% endblock %}

{% block body %}
    <h1>
        Mes projets de l'année

        {% if projetsYears %}
            <select
                id="projets-year-filter"
                data-url-all="{{ url('app_fo_projets_all') }}"
                data-url-by-year="{{ url('app_fo_projets_by_year', {"year": 2000}) }}"
            >
                <option value="all">toutes</option>
                {% for year in projetsYears|reverse %}
                    <option
                        {% if year == selectedYear %}selected="selected"{% endif %}
                        value="{{ year }}"
                    >{{ year }}</option>
                {% endfor %}
            </select>
        {% endif %}
    </h1>

    {% if is_granted('ROLE_FO_ADMIN') %}
        <p>
            Liste des projets auxquels je participe.
        </p>
        <p>
            <i class="fa fa-info-circle" aria-hidden="true"></i>
            En tant qu'administrateur, je peux aussi
            <a href="{{ path('app_fo_admin_projets') }}">accéder à tous les projets de la société</a>.
        </p>
    {% endif %}

    <table class="table  text-center mx-auto m-5">
        <thead>
            <tr>
                <th scope="col" class="text-left">Projet</th>
                <th scope="col">Mon rôle</th>
                <th scope="col" class="d-none d-md-table-cell">Début</th>
                <th scope="col" class="d-none d-md-table-cell">Fin</th>
                <th scope="col" class="d-none d-md-table-cell">Statut</th>
                <th scope="col">Participants</th>
            </tr>
        </thead>
        <tbody>
            {% for projet in projets %}
                <tr>
                    <td scope="row" class="text-left"> <a href="{{ path('app_fo_projet', {'id': projet.id}) }}">{{ projet.acronyme }}</a> </td>
                    <td class="text-center">{{ userRoleOn(projet)|trans }}</td>
                    <td class="text-center d-none d-md-table-cell">{{ projet.dateDebut ? projet.dateDebut|date('d/m/Y') : '-' }}</td>
                    <td class="text-center d-none d-md-table-cell">{{ projet.dateFin ? projet.dateFin|date('d/m/Y') : '-' }}</td>
                    <td class="text-center d-none d-md-table-cell">{{ projet.statut }}</td>
                    <td class="text-center">{{ projet.projetParticipants|length }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="button mb-4">
        <a
            class="btn btn-outline-success {{ is_granted('ROLE_FO_CDP') ? '' : 'disabled' }}"
            href="{{ path('app_fo_projet_creation') }}"
            {% if not is_granted('ROLE_FO_CDP') %}
                title="Vous devez avoir le rôle de chef de projet pour créer un nouveau projet."
            {% endif %}
        >
            <i class="fa fa-plus" aria-hidden="true"></i>
            Nouveau projet
        </a>
    </div>
{% endblock %}
