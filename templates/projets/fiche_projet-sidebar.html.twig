<dl>
    {% if participation %}
        {% if projet.chefDeProjet != userContext.societeUser %}
            <p>Je suis <strong>{{ participation.role|trans }}</strong> sur ce projet.</p>
        {% endif %}
    {% else %}
        {# participation can be null when admin view a projet of his societe but without access #}
        <p>Vous n'avez <strong>pas de rôle</strong> sur ce projet.</p>
    {% endif %}
    {% if projet.dateDebut %}
        <dt>Date de début</dt>
        <dd>{{ projet.dateDebut|format_date }}</dd>
    {% endif %}
    {% if projet.dateFin %}
        <dt>Date de fin</dt>
        <dd>{{ projet.dateFin|format_date }}</dd>
    {% endif %}
    <dt>Statut</dt>
    <dd>{{ projet.statut }}</dd>
</dl>

<hr>

{% if participation %}
    <div class="watch-projet" data-projet-id="{{ projet.id }}">
        {% if participation.watching %}
            <button class="btn btn-block btn-primary">
                <i class="fa fa-eye"></i>
                Suivre le projet
                <i class="fa fa-check"></i>
            </button>
        {% else %}
            <button class="btn btn-block btn-outline-primary">
                <i class="fa fa-eye"></i>
                Suivre le projet
            </button>
        {% endif %}

        <p class="text-muted">
            <small>
                Suivez ce projet pour recevoir une notification
                en temps réel à chaque mise à jour de ce projet.
            </small>
        </p>
    </div>
{% else %}
    <button class="btn btn-block btn-outline-primary" disabled>
        <i class="fa fa-eye"></i>
        Suivre le projet
    </button>
    <p class="text-muted">
        <small>
            Vous ne pouvez pas suivre ce projet
            car vous devez avoir au moins le rôle d'observateur sur ce projet.
        </small>
    </p>
{% endif %}

<hr>

<a
    href="{{ path('app_fo_projet_participant', {'id': projet.id}) }}"
    class="btn btn-outline-primary rounded-circle float-right {{ userCanEditProjet ? '' : 'disabled' }}"
    {% if not userCanEditProjet %}
        title="Seul le chef de projet peut gérer les participants"
    {% else %}
        title="Gérer les participants"
    {% endif %}
><i class="fa fa-cog"></i></a>

<h4>Contributeurs ({{ contributeurs|length }})</h4>

<ul class="list-unstyled">
    {% for contributeur in contributeurs %}
        <li>
            {{ contributeur.societeUser|entityLink }}
        </li>
    {% else %}
        <li>Il n'y a pas de contributeur pour l'instant.</li>
    {% endfor %}
</ul>

<button type="button" class="mt-3 btn-block btn-primary" data-toggle="modal" data-target="#exampleModal">
    Voir les observateurs
</button>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">{{ 'n_observateur'|trans({'n': projet.projetParticipants|filterByRoleExactly(constant('App\\Security\\Role\\RoleProjet::OBSERVATEUR'))|length}) }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul>
                    {% for projetParticipant in projet.projetParticipants|filterByRoleExactly(constant('App\\Security\\Role\\RoleProjet::OBSERVATEUR'))%}
                        {% if projetParticipant.societeUser.invitationToken == null %}
                        <li>{{ projetParticipant.societeUser.user.fullname }} </li>

                        {% endif %}

                    {% else %}
                        <div>Il n'y a pas d'observateur pour l'instant</div>
                    {% endfor %}
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


{% if projet.fichierProjets|length > 0 %}
    <hr>

    <h4>Fichiers</h4>

    <ul class="list-unstyled">
        {% for fichierProjet in projet.fichierProjets[0:5] %}
            <li>
                <a href="{{ path('app_fo_projet_fichier', {'projetId': projet.id, 'fichierProjetId': fichierProjet.id}) }}">
                    <i class="fa {{ fichierProjet|faFileIcon }}" aria-hidden="true"></i>
                    {{ fichierProjet.fichier.nomFichier }}
                </a>
            </li>
        {% endfor %}
    </ul>

    {% if projet.fichierProjets|length > 5 %}
        <p>et {{ projet.fichierProjets|length - 5 }} autres...</p>
    {% endif %}

    <a href="{{ path('app_fo_projet_fichiers', {'id': projet.id}) }}">Voir tous les fichiers</a>
{% endif %}
